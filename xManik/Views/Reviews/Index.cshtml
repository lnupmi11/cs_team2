@model Tuple< ICollection<xManik.Models.Review> , string>
@using System.Security.Claims;
@{
    ViewData["Title"] = "Index";
    var currentClientId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<div ng-app="myApp" class="section sm-padding bg-grey">
    @if (User.IsInRole("Client"))
    {
        <div class="col-md-12">
            <form class="form-horizontal" ng-controller="AddReviewCtrl">
                <h3 class="text-center">Add your review about this user</h3>
                <br/>
                <div class="form-group">
                    <label class="col-md-2 control-label" for="message">Your message</label>
                    <div class="col-md-9">
                        <textarea class="form-control" ng-model="review.Message" name="message" placeholder="Please enter your feedback here..." rows="5"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-md-2 control-label" for="message">Your rating</label>
                    <div class="col-md-9">
                        <input id="input-21e" value="0" type="number" ng-model="review.Rating" class="rating" min=0 max=5 step=0.5 data-size="xs">
                    </div>
                </div>
                <button type="button" ng-click="add(review,'@currentClientId','@Model.Item2','@Url.Action("Create","Reviews")')" class="btn btn-info center-block">Add</button>
            </form>
        </div>
        <hr>
    }


    <div class="blog-comments">
        <h3 class="title">(@Model.Item1.Count) Reviews</h3>
        @foreach (var review in Model.Item1)
        {
        <!-- comment -->
            <div class="media bg-light-aqua" ng-controller="DeleteReviewCtrl">
                <div class="media-left">
                    <img class="media-object" src="./img/perso2.jpg" alt="">
                </div>
                <div class="media-body">
                    <h4 class="media-heading">
                        @review.ClientId<span class="time">@review.DatePosted</span>
                        @if (review.ClientId == currentClientId)
                        {
                            <a class="reply" ng-click="delete('@review.ReviewId','@Url.Action("Delete", "Reviews")')">Delete</a>
                        }
                    </h4>
                    <p>@review.Message</p>
                </div>
                <div class="review-block-rate">
                    <div class="col-sm-12">
                        <input disabled value="@review.Rating.ToString().Replace(',','.')" type="number" class="rating" step="0.5" data-size="xs">
                    </div>
                </div>
            </div>
            <br />
             <!-- /comment -->
        }
    </div>
</div>